{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Client Satisfaction Survey</title>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/css/bootstrap.min.css" rel="stylesheet">

  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      background: url("{% static 'pictures/Background.svg' %}") no-repeat center center fixed;
      background-size: cover;
    }

    .main-content {
      flex: 1;
      padding: 2rem;
    }

    .survey-form {
      background: rgba(255, 255, 255, 0.95);
      border-radius: 10px;
      padding: 2rem;
      box-shadow: 0 5px 15px rgba(0,0,0,0.2);
      max-width: 900px;
      margin: 0 auto;
    }

    .instructions {
      background-color: #f8f9fa;
      padding: 1rem;
      border-left: 4px solid #10934F;
      margin-bottom: 2rem;
      font-weight: bold;
    }

    .instructions-stars {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin-top: 10px;
      font-weight: normal;
    }

    .instructions-stars .star-yellow {
      color: #FFD700; /* Yellow stars */
      font-size: 18px;
    }

    .rating-table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 2rem;
    }

    .rating-table th,
    .rating-table td {
      border: 1px solid #ddd;
      padding: 0.75rem;
      text-align: left;
      vertical-align: middle;
    }

    .rating-table th {
      background-color: #10934F;
      color: white;
    }

    .question-cell {
      text-align: left;
      font-weight: bold;
      background-color: #f8f9fa;
    }

    .question-code {
      color: #10934F;
      font-weight: bold;
    }

    .stars {
      display: flex;
      justify-content: center;
      gap: 5px;
    }

    .star {
      font-size: 28px;
      color: #ddd;
      cursor: pointer;
      transition: color 0.2s;
    }

    .star.hover,
    .star.selected {
      color: #ffd700;
    }

    .feedback-section, .email-section {
      margin: 2rem 0;
    }

    .feedback-label, .email-label {
      font-weight: bold;
      display: block;
      margin-bottom: 0.5rem;
    }

    .feedback-textarea, .email-input {
      width: 100%;
      padding: 0.75rem;
      border: 1px solid #ddd;
    }

    .navigation-buttons {
      display: flex;
      justify-content: space-between;
      margin-top: 2rem;
    }

    .nav-button {
      padding: 0.75rem 2rem;
      border: none;
      font-weight: bold;
      cursor: pointer;
    }

    .back-button {
      background-color: #6c757d;
      color: white;
    }

    .next-button {
      background-color: #10934F;
      color: white;
    }

    .page-footer {
      background-color: #10934F;
      height: 50px;
      margin-top: auto;
    }
  </style>
</head>
<body>
  <div>
      <img src="{% static 'pictures/header-logo.svg' %}" alt="Logo" class="h-16 m-4">
  </div>
      <main class="main-content">
        <div class="survey-form">
          <form method="POST" action="{% url 'page3' %}">
            {% csrf_token %}

            <div class="instructions">
              <strong>INSTRUCTIONS:</strong><br>
              For SOD 0-8, please click the star (★) on the row that best corresponds to your answer.
              
              <div class="instructions-stars">
                <div>Strongly Agree = <span class="star-yellow">★★★★★</span></div>
                <div>Agree = <span class="star-yellow">★★★★</span></div>
                <div>Neither Agree nor Disagree = <span class="star-yellow">★★★</span></div>
                <div>Disagree = <span class="star-yellow">★★</span></div>
                <div>Strongly Disagree = <span class="star-yellow">★</span></div>
                <div>N/A Not Applicable = Leave it blank</div>
              </div>
            </div>

            <!-- Rating Table -->
            <table class="rating-table">
              <thead>
                <tr>
                  <th>Service Quality Dimensions</th>
                  <th>Rating</th>
                </tr>
              </thead>
              <tbody id="questionsBody"></tbody>
            </table>

            <!-- Feedback -->
            <div class="feedback-section">
              <label class="feedback-label">Suggestion on how we can further improve our services (optional):</label>
              <textarea class="feedback-textarea" id="feedbackText" name="feedback">{{ feedback|default:'' }}</textarea>
            </div>

            <!-- Email -->
            <div class="email-section">
              <label class="email-label">Email address (Optional):</label>
              <input type="email" class="email-input" id="emailInput" name="email" value="{{ email|default:'' }}">
            </div>

            <!-- Buttons -->
            <div class="navigation-buttons">
              <button type="submit" name="back" class="nav-button back-button">BACK</button>
              <button type="submit" class="nav-button next-button">Done</button>
            </div>
          </form>
        </div>
      </main>

      <footer class="page-footer"></footer>

      <script>
        const questions = [
          { code: "SOD0.", text: "I am satisfied with service that I availed" },
          { code: "SOD1.", text: "I spent a reasonable amount of time for my transaction." },
          { code: "SOD2.", text: "The office followed the transaction's requirements and steps based on the information provided." },
          { code: "SOD3.", text: "The steps (including payment) I needed to do my transaction were easy and simple." },
          { code: "SOD4.", text: "I easily found information about my transaction from the office or its website." },
          { code: "SOD5.", text: "I paid a reasonable amount of fees for my transaction. (If service is free, mark N/A column)" },
          { code: "SOD6.", text: "I feel the office was fair to everyone or 'walang palakasan' during my transaction." },
          { code: "SOD7.", text: "I was treated courteously by the staff, and (if asked for help) the staff was helpful." },
          { code: "SOD8.", text: "I got what I needed from the government office, or (if denied) denial of request was sufficiently explained to me." }
        ];

        // ✅ Pull saved ratings
        const savedRatings = {
          {% if request.session.page3 %}
            {% for key, value in request.session.page3.items %}
              "{{ key }}": "{{ value|default:'' }}",
            {% endfor %}
          {% endif %}
        };

        function loadQuestions() {
          const tbody = document.getElementById("questionsBody");
          tbody.innerHTML = "";

          questions.forEach((q, index) => {
            let key = `sod${index}`;
            let savedValue = savedRatings[key] || "0";  // ✅ Default to "0" (N/A) if blank
            let row = `<tr>
              <td class="question-cell"><span class="question-code">${q.code}</span> ${q.text}</td>
              <td>
                <div class="stars" data-question="${key}">
                  ${[1,2,3,4,5].map(num => 
                    `<span class="star ${savedValue > 0 && num <= savedValue ? 'selected' : ''}" data-value="${num}">&#9733;</span>`
                  ).join("")}
                  <input type="hidden" name="${key}" id="${key}" value="${savedValue}">
                </div>
              </td>
            </tr>`;
            tbody.innerHTML += row;
          });

          setupStars();
        }

        function setupStars() {
          document.querySelectorAll(".stars").forEach(starContainer => {
            const stars = starContainer.querySelectorAll(".star");
            const hiddenInput = starContainer.querySelector("input");

            stars.forEach((star, index) => {
              star.addEventListener("mouseover", () => {
                stars.forEach((s, i) => s.classList.toggle("hover", i <= index));
              });

              star.addEventListener("mouseout", () => {
                stars.forEach(s => s.classList.remove("hover"));
              });

              star.addEventListener("click", () => {
                const value = star.getAttribute("data-value");
                hiddenInput.value = value; 
                stars.forEach((s, i) => s.classList.toggle("selected", i < value));
              });
            });
          });
        }

        document.addEventListener("DOMContentLoaded", loadQuestions);
      </script>
</body>
</html>

{% extends 'display/base.html' %}

{% block title %}
Home Students
{% endblock  %}

{% block content %}
{% load static %}
<!-- Content -->


<section class="text-white">
  <div class="flex flex-col items-center justify-center mt-6">
    <h1 class="text-9xl font-semibold text-shadow-md/50">CALLING NUMBER</h1>

    <div
      class="flex flex-col bg-white min-w-[441.6px]  text-black py-10 px-15 rounded-4xl mt-6 shadow-[0_7px_7px_10px_rgba(0,0,0,0.3)]"
    >
      <h1
        id="ticketNumber"
        class="text-[240px] leading-none font-medula text-center text-[#10934F]"
      >
        -
      </h1>
      <p id="studentName" class="text-3xl text-[#10934F]">...</p>
    </div>

    <div class="flex flex-col items-center mt-10">
      <!-- <p class="text-2xl">Time</p> -->
      <p id="studentTime" class="text-4xl font-poppins">-- : --</p>
    </div>
  </div>
</section>

<script>
  const ticketEl = document.getElementById("ticketNumber");
  const nameEl = document.getElementById("studentName");
  const timeEl = document.getElementById("studentTime");

  function updateTime() {
    const timeEl = document.getElementById("studentTime");
    const now = new Date();

    const month = now.toLocaleString("default", { month: "short" }); // Aug
    const day = now.getDate();
    const year = now.getFullYear();
    const hours = String(now.getHours()).padStart(2, "0");
    const minutes = String(now.getMinutes()).padStart(2, "0");
    const seconds = String(now.getSeconds()).padStart(2, "0");

    timeEl.textContent = `${month} ${day}, ${year} - ${hours}:${minutes}:${seconds}`;
  }


  // Connect to Django Channels WebSocket
  const socket = new WebSocket("ws://" + window.location.host + "/ws/display/");

  socket.onmessage = function (event) {
    const data = JSON.parse(event.data);
    const current = data.current;

    if (current) {
      ticketEl.textContent = current.ticket_number || "R-000";
      nameEl.textContent =
        (current.user_type || "");
      
    } else {
      ticketEl.textContent = "-";
      nameEl.textContent = "...";
     
    }
  };

  updateTime();
  setInterval(updateTime, 1000);
</script>



{% endblock %}